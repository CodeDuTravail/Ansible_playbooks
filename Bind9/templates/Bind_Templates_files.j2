# templates/named.conf.options.j2
options {
        directory "/var/cache/bind";

        // Listen on local interfaces only
        listen-on { 127.0.0.1; {{ dns_listen_address }}; };
        
        // Allow queries from local network only
        allow-query { localhost; 192.168.1.0/24; };

        // Disable recursion for security (only answer for zones we are authoritative for)
        // Change to yes if you want to use this as a caching DNS server
        recursion yes;

        // Forwarders for external domain resolution
        forwarders {
{% for forwarder in dns_forwarders %}
                {{ forwarder }};
{% endfor %}
        };

        dnssec-validation auto;
        auth-nxdomain no;    # conform to RFC1035
};

# templates/named.conf.local.j2
// Forward zone for {{ domain_name }}
zone "{{ domain_name }}" {
        type master;
        file "/etc/bind/zones/db.{{ domain_name }}";
        allow-transfer { none; };  // Restrict zone transfers
};

// Reverse zone for 192.168.1.0/24
zone "1.168.192.in-addr.arpa" {
        type master;
        file "/etc/bind/zones/db.192.168.1";
        allow-transfer { none; };  // Restrict zone transfers
};

# templates/db.forward.j2
$TTL    604800
@       IN      SOA     ns1.{{ domain_name }}. admin.{{ domain_name }}. (
                          2         ; Serial
                     604800         ; Refresh
                      86400         ; Retry
                    2419200         ; Expire
                     604800 )       ; Negative Cache TTL
;
@       IN      NS      ns1.{{ domain_name }}.
@       IN      A       {{ dns_listen_address }}
ns1     IN      A       {{ dns_listen_address }}

{% for record in dns_records %}
{{ record.name }}  IN      {{ record.type }}   {{ record.value }}
{% endfor %}

# templates/db.reverse.j2
$TTL    604800
@       IN      SOA     ns1.{{ domain_name }}. admin.{{ domain_name }}. (
                          1         ; Serial
                     604800         ; Refresh
                      86400         ; Retry
                    2419200         ; Expire
                     604800 )       ; Negative Cache TTL
;
@       IN      NS      ns1.{{ domain_name }}.

; PTR Records
10      IN      PTR     www.{{ domain_name }}.
20      IN      PTR     mail.{{ domain_name }}.
{{ dns_listen_address.split('.')[-1] }}      IN      PTR     ns1.{{ domain_name }}.